## Идея
<!-- По дефолту опенкарт пишет в бд сессию юзера, из нее забирает id товара и выводит данные товаров. Когда юзер на странице коризны нажимает кнопку "удалить", в бд удаляется запись с этим товаром -->

по дефолту при добавлении товара в корзину, опенкарт добавляет новую строку в таблицу `'db_prefix'_cart`, в которой сохранятеся id сессии юзера и id товара, по которому потом получает данные о товаре, а при удалении эта строка удаляется из таблицы.

Идея залючается в том чтобы добавить в таблицу столбец (boolean), который будет хранить информацию удален ли товар (0 или 1), и вместо того чтобы удалять строку, в этот столбец будет заноситься информация о состоянии, и вся дальнейшая сортировка будет происходить по этому значению в этом столбце, в laravel есть подобный функционал soft delete, поэтому далее для удобства я буду называть функционал, который мы реализуем мягким удалением. Далее изменить стандартную обработку информации из бд. 

## Этапы

### База данных

Необходимо в базе данных найти таблицу `oc_cart`(возможно у вас какой-то кастомный префикс к таблицам, я буду использовать дефолтный) и добавить новый столбец с названием `is_deleted`, тип boolean (tinyInt), nullable, с значением по умолчанию Null. Вы можете это сделать через веб-интерфейс (phpMyAdmin) или через sql запрос, на вам удобно, думаю не должно составить труда. 

### Запросы в бд
Открываем файл `system\library\cart\cart.php`. Ищем метод `getProducts()`, собственно он и отвечает за вывод товаров, которые находятся в коризны. Массив, который возвращает этот метод, работает для всего где есть данные о добавленных товарах в корзину. 

1. Ищем переменную `$cart_query`, в которой sql запрос. Добавляем в запрос условие `is_deleted = 0`. В итоге запрос должен выглядеть так:

```sh
$cart_query = $this->db->query("SELECT * FROM " . DB_PREFIX . "cart WHERE is_deleted = 0 AND api_id = '" . (isset($this->session->data['api_id']) ? (int)$this->session->data['api_id'] : 0) . "' AND customer_id = '" . (int)$this->customer->getId() . "' AND session_id = '" . $this->db->escape($this->session->getId()) . "'");
```

2. Далее видем в коде, что идет перебор данных, которые получили в ответ на sql запрос, в этом переборе ищем `$product_data[] = array(` и добавляем строку:

```sh
'is_deleted'    => $cart['is_deleted'],
```

3. В самом конце класса добавим новый метод, который будет отвечать за это самое мягкое удаление товара: 

```sh
public function removeProduct($cart_id)
{
    $this->db->query("UPDATE `" . DB_PREFIX . "cart` SET is_deleted = 1 WHERE cart_id = '" . (int)$cart_id . "'");
}
```
Как видим, метод принимает аргумент `$cart_id`, который является auto increment значением, которое просто идентифицирует нужный товар. Я считаю что в данном методе проверять сессию пользователя и сам product_id нет необходимости.

